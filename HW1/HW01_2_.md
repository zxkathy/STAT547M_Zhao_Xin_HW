HW1 Task2
================

``` r
library(dplyr)
```

    ## 
    ## Attaching package: 'dplyr'

    ## The following objects are masked from 'package:stats':
    ## 
    ##     filter, lag

    ## The following objects are masked from 'package:base':
    ## 
    ##     intersect, setdiff, setequal, union

``` r
library(gapminder)
library(robustbase)
```

    ## Warning: package 'robustbase' was built under R version 3.4.2

``` r
library(stringr)
```

Task2: Writing Functions
------------------------

Q: Write one (or more) functions that do something useful to pieces of the Gapminder data. It is logical to think about computing on the mini-data frames corresponding to the data for each specific country, location, year, band, album, â€¦ This would pair well with the prompt below about working with a nested data frame, as you could apply your function there.

A: I want to use robust regression, using robustbase::lmrob(). The aim of this function is calculate coefficients of robust linear regression models between x = log(gdpPercap) and y = lifeExp, given a specific year or country. (The reason I take log of x is to make the coefficients nicer.)

``` r
rob_reg <- function(input){
  if(is.numeric(input)) {
    if(!input %in% unique(gapminder$year)){
      stop('Gapminder dataset doesn\'t have the year you specified!\n')
    }else{
      subdat = gapminder %>%
        filter(year == input)
      fit <- lmrob(lifeExp ~ I(log(gdpPercap)), data = subdat)
      return(coef(fit))
    }
  }
  
  if(is.character(input)){
    ctry <- input %>%
      str_trim(side = "both") %>%
      str_to_lower()
    if(!ctry %in% str_to_lower(unique(gapminder$country))){
      stop('Gapminder dataset doesn\'t have the country you specified!\n')
    }else{
      subdat = gapminder %>%
        mutate(lower_ctry = str_to_lower(country)) %>%
        filter(lower_ctry == ctry)
      fit <- lmrob(lifeExp ~ I(log(gdpPercap)), data = subdat)
      return(coef(fit))
    }
  }
  else{
    stop('Please recheck the format of your input!\n')
  }
}
```

Let's test the function and check whether it works as expected. Firstly, I input a correct year and the result should be the corresponding intercept and slope. Then I input an incorrect year and it should give me an error.

``` r
rob_reg(1952)
```

    ##       (Intercept) I(log(gdpPercap)) 
    ##         -27.77848          10.23692

``` r
#rob_reg(2017)
```

Then, let's try to input the character, we can input the correct format, such as `Canada` or `United States`, and we can even input lower-cased countries, with several spaces before the country name, such as `canada`. All these inputs could generate corresponding results. But if you input some country doesn't exist in gapminder dataset, it should give you an error message.

``` r
rob_reg("United States")
```

    ##       (Intercept) I(log(gdpPercap)) 
    ##        -13.466535          8.601552

``` r
rob_reg("  canada")
```

    ##       (Intercept) I(log(gdpPercap)) 
    ##         -25.18752          10.06203

``` r
#rob_reg("wonderland")
```
